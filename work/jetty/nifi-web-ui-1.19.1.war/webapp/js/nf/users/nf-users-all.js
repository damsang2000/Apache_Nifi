(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common"],function(c,d){return(nf.Client=b(c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Client=b(require("jquery"),require("nf.Common")))}else{nf.Client=b(a.$,a.nf.Common)}}}(this,function(b,c){var a=null;return{init:function(){return b.ajax({type:"GET",url:"../nifi-api/flow/client-id",}).done(function(d){a=d})},getRevision:function(e){return{clientId:a,version:e.revision.version}},isNewerRevision:function(f,d){if(c.isDefinedAndNotNull(f)){var g=f.revision;var e=d.revision;return e.version>=g.version}else{return true}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.Dialog=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Dialog=b(require("jquery")))}else{nf.Dialog=b(a.$)}}}(this,function(b){b(document).ready(function(){b("#nf-ok-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){b("#nf-ok-dialog-content").empty()}}});b("#nf-yes-no-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){b("#nf-yes-no-dialog-content").empty();b("#nf-yes-no-dialog").modal("setButtonModel",[])}}})});var a={showOkDialog:function(c){c=b.extend({headerText:"",dialogContent:""},c);var d=b("<p></p>").append(c.dialogContent);b("#nf-ok-dialog-content").append(d).append("</br>");b("#nf-ok-dialog").modal("setButtonModel",[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#nf-ok-dialog").modal("hide");if(typeof c.okHandler==="function"){c.okHandler.call(this)}}}}]);b("#nf-ok-dialog").modal("setHeaderText",c.headerText).modal("show")},showYesNoDialog:function(c){c=b.extend({headerText:"",dialogContent:"",yesText:"Yes",noText:"No"},c);var d=b("<p></p>").append(c.dialogContent);b("#nf-yes-no-dialog-content").append(d);b("#nf-yes-no-dialog").modal("setButtonModel",[{buttonText:c.yesText,color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#nf-yes-no-dialog").modal("hide");if(typeof c.yesHandler==="function"){c.yesHandler.call(this)}}}},{buttonText:c.noText,color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){b("#nf-yes-no-dialog").modal("hide");if(typeof c.noHandler==="function"){c.noHandler.call(this)}}}}]);b("#nf-yes-no-dialog").modal("setHeaderText",c.headerText).modal("show")},showDisconnectedFromClusterMessage:function(c){a.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node is currently not connected to the cluster. Any modifications to the data flow made here will not replicate across the cluster.",okHandler:function(){if(typeof c==="function"){c.call(this)}}})},showConnectedToClusterMessage:function(c){a.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node just joined the cluster. Any modifications to the data flow made here will replicate across the cluster.",okHandler:function(){if(typeof c==="function"){c.call(this)}}})}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.AuthorizationStorage=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.AuthorizationStorage=b())}else{nf.AuthorizationStorage=b()}}}(this,function(){var b="Access-Token-Expiration";var a=new RegExp("Request-Token=([^;]+)");return{getRequestToken:function(){var c=null;var d=a.exec(document.cookie);if(d){c=d[1]}return c},getToken:function(){return sessionStorage.getItem(b)},hasToken:function(){var c=this.getToken();return typeof c==="string"},removeToken:function(){sessionStorage.removeItem(b)},setToken:function(c){sessionStorage.setItem(b,c)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.Storage=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Storage=b())}else{nf.Storage=b()}}}(this,function(){var h=false;var g=86400000;var f=g*2;var b=function(i){return typeof i==="undefined"};var e=function(i){return i===null};var d=function(i){return !b(i)&&!e(i)};var c=function(k){if(d(k.expires)){var i=new Date(k.expires);var j=new Date();return i.valueOf()<j.valueOf()}else{return false}};var a=function(i){try{var j=JSON.parse(localStorage.getItem(i));if(d(j)){return j}else{return null}}catch(k){return null}};return{init:function(){for(var k=0;k<localStorage.length;k++){try{var j=localStorage.key(k);this.getItem(j)}catch(l){}}},acknowledgeDisconnection:function(){h=true},resetDisconnectionAcknowledgement:function(){h=false},isDisconnectionAcknowledged:function(){return h},setItem:function(j,l,i){i=d(i)?i:new Date().valueOf()+f;var k={expires:i,item:l};localStorage.setItem(j,JSON.stringify(k))},hasItem:function(i){return a(i)!==null},getItem:function(i){var j=a(i);if(j===null){return null}if(c(j)){this.removeItem(i);return null}if(d(j.item)){return j.item}else{return null}},getItemExpiration:function(i){var j=a(i);if(j===null){return null}if(d(j.expires)){return j.expires}else{return null}},removeItem:function(i){localStorage.removeItem(i)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.AuthorizationStorage","lodash","moment"],function(f,e,c,d,g){return(nf.Common=b(f,e,c,d,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Common=b(require("jquery"),require("d3"),require("nf.AuthorizationStorage"),require("lodash"),require("moment")))}else{nf.Common=b(a.$,a.d3,a.nf.AuthorizationStorage,a._,a.moment)}}}(this,function(f,e,b,c,h){f(document).ready(function(){var i="images/bg-error.png";f("<img/>").attr("src",i).on("load",function(){f("div.message-pane").css("background-image",i)});f(document).on("mouseenter","span.link",function(){f(this).addClass("link-over")}).on("mouseleave","span.link",function(){f(this).removeClass("link-over")});f(document).on("click","div.nf-checkbox",function(){var l=f(this);var k=l.hasClass("checkbox-unchecked");var j=l.hasClass("disabled");if(j){return}if(k){l.removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{l.removeClass("checkbox-checked").addClass("checkbox-unchecked")}l.trigger("change",{isChecked:k})});f(document).on("click",".nf-checkbox-label",function(j){f(j.target).parent().find(".nf-checkbox").click()});f(document).ajaxStart(function(){f("div.loading-container").addClass("ajax-loading")}).ajaxStop(function(){f("div.loading-container").removeClass("ajax-loading")});if(b.hasToken()){f("#user-logout-container").css("display","block");g.scheduleTokenRefresh()}f("#user-logout").on("click",function(){f.ajax({type:"DELETE",url:"../nifi-api/access/logout",}).done(function(){b.removeToken();window.location="../nifi/logout"}).fail(nfErrorHandler.handleAjaxError)});f("#user-home").on("click",function(){if(top!==window){parent.window.location="../nifi/"}else{window.location="../nifi/"}})});var d=null;var a=[{text:"view the user interface",value:"flow",description:"Allows users to view the user interface"},{text:"access the controller",value:"controller",description:"Allows users to view/modify the controller including Management Controller Services, Reporting Tasks, Registry Clients, Parameter Providers and nodes in the cluster"},{text:"access parameter contexts",value:"parameter-contexts",description:"Allows users to view/modify Parameter Contexts"},{text:"query provenance",value:"provenance",description:"Allows users to submit a Provenance Search and request Event Lineage"},{text:"access restricted components",value:"restricted-components",description:"Allows users to create/modify restricted components assuming other permissions are sufficient"},{text:"access all policies",value:"policies",description:"Allows users to view/modify the policies for all components"},{text:"access users/user groups",value:"tenants",description:"Allows users to view/modify the users and user groups"},{text:"retrieve site-to-site details",value:"site-to-site",description:"Allows other NiFi instances to retrieve Site-To-Site details of this NiFi"},{text:"view system diagnostics",value:"system",description:"Allows users to view System Diagnostics"},{text:"proxy user requests",value:"proxy",description:"Allows proxy machines to send requests on the behalf of others"},{text:"access counters",value:"counters",description:"Allows users to view/modify Counters"}];var g={ANONYMOUS_USER_TEXT:"Anonymous user",config:{sensitiveText:"Sensitive value set",tooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:function(i){f(this).slideDown(100)}},hide:{effect:function(i){f(this).slideUp(100)}},position:{at:"top center",my:"bottom center"}}},SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,currentUser:undefined,sortVersion:function(j,t){if(j===t){return 0}var p=j.split(/-/);var u=t.split(/-/);if(p.length>=1&&u.length>=1){var r=p[0].split(/\./);var o=u[0].split(/\./);if(r.length>=1&&o.length>=1){var m=Math.min(r.length,o.length);for(var n=0;n<m;n++){var s=parseInt(r[n],10);var l=parseInt(o[n],10);if(isNaN(s)&&isNaN(l)){continue}else{if(isNaN(s)){return -1}else{if(isNaN(l)){return 1}}}if(s!==l){return s-l}}if(r.length===o.length){if(p.length===u.length){var q=g.substringAfterFirst(j,p[0]);var k=g.substringAfterFirst(t,u[0]);return q===k?0:q>k?1:-1}else{return u.length-p.length}}else{return r.length-o.length}}else{if(r.length>=1){return 1}else{if(o.length>=1){return -1}else{return 0}}}}else{if(p.length>=1){return 1}else{if(u.length>=1){return -1}else{return 0}}}},sortType:function(i,l){var j=function(o,m){var p=g.formatBundle(o.bundle);var n=g.formatBundle(m.bundle);return p===n?0:p>n?1:-1};var k=function(t,s){if(i.columnId==="version"){var r=g.isDefinedAndNotNull(t.bundle[i.columnId])?t.bundle[i.columnId]:"";var p=g.isDefinedAndNotNull(s.bundle[i.columnId])?s.bundle[i.columnId]:"";var n=g.sortVersion(r,p);return n===0?j(t,s):n}else{if(i.columnId==="type"){var q=g.substringAfterLast(t[i.columnId],".");var o=g.substringAfterLast(s[i.columnId],".");return q===o?0:q>o?1:-1}else{var m=g.isDefinedAndNotNull(t[i.columnId])?t[i.columnId]:"";var u=g.isDefinedAndNotNull(s[i.columnId])?s[i.columnId]:"";return m===u?j(t,s):m>u?1:-1}}};l.sort(k,i.sortAsc)},typeFormatter:function(n,j,m,l,i){var k="";if(i.restricted===true){k+='<div class="view-usage-restriction fa fa-shield"></div><span class="hidden row-id">'+g.escapeHtml(i.id)+"</span>"}else{k+='<div class="fa"></div>'}k+=g.escapeHtml(m);return k},genericValueFormatter:function(m,j,l,k,i){return g.escapeHtml(l)},typeBundleFormatter:function(m,j,l,k,i){return g.escapeHtml(g.formatBundle(i.bundle))},typeVersionFormatter:function(n,j,m,l,i){var k="";if(g.isDefinedAndNotNull(i.bundle)){k+=('<div style="float: left;">'+g.escapeHtml(i.bundle.version)+"</div>")}else{k+='<div style="float: left;">unversioned</div>'}if(!g.isEmpty(i.controllerServiceApis)){k+='<div class="controller-service-apis fa fa-list" title="Compatible Controller Service" style="margin-left: 4px;"></div><span class="hidden row-id">'+g.escapeHtml(i.id)+"</span>"}k+='<div class="clear"></div>';return k},instanceTypeFormatter:function(m,j,l,k,i){if(!i.permissions.canRead){return""}return g.escapeHtml(g.formatType(i.component))},instanceBundleFormatter:function(m,j,l,k,i){if(!i.permissions.canRead){return""}return g.typeBundleFormatter(m,j,l,k,i.component)},getVersionControlTooltip:function(i){return i.stateExplanation},formatClassName:function(i){return g.substringAfterLast(i.type,".")},formatType:function(i){var j=g.formatClassName(i);if(i.bundle.version!=="unversioned"){j+=(" "+i.bundle.version)}return j},formatBundle:function(i){var j="";if(i.group!=="default"){j=i.group+" - "}return j+i.artifact},setCurrentUser:function(i){g.currentUser=i},scheduleTokenRefresh:function(){if(d!==null){clearInterval(d)}var i=g.MILLIS_PER_MINUTE;var j=function(){var o=b.getToken();if(o!==null){var l=parseInt(o,10)*g.MILLIS_PER_SECOND;var n=new Date(l);var m=new Date();var k=n.valueOf()-m.valueOf()-(30*g.MILLIS_PER_SECOND);if(k<i){if(f("#current-user").text()!==g.ANONYMOUS_USER_TEXT&&!f("#anonymous-user-alert").is(":visible")){f("#anonymous-user-alert").show().qtip(f.extend({},g.config.tooltipConfig,{content:"Your session will expire soon. Please log in again to avoid being automatically logged out.",position:{my:"top right",at:"bottom left"}}))}}}};j();d=setInterval(j,i)},setAnonymousUserLabel:function(){var i=f("#anonymous-user-alert");if(i.data("qtip")){i.qtip("api").destroy(true)}i.show().qtip(f.extend({},g.config.tooltipConfig,{content:"You are accessing with limited authority. Log in or request an account to access with additional authority granted to you by an administrator.",position:{my:"top right",at:"bottom left"}}));f("#current-user").text(g.ANONYMOUS_USER_TEXT).show()},getSessionExpiration:function(j){var k=null;var i=g.getJwtPayload(j);if(i){k=i.exp}return k},getDefaultExpiration:function(){var j=new Date();var i=j.getTime()+43200000;var k=Math.round(i/1000);return k.toString()},getJwtPayload:function(j){if(g.isDefinedAndNotNull(j)){var i=j.split(/\./);if(i.length!==3){return""}var l=f.base64.atob(i[1]);var k=JSON.parse(l);if(g.isDefinedAndNotNull(k)){return k}else{return null}}return null},canVersionFlows:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.canVersionFlows===true}else{return false}},canAccessProvenance:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.provenancePermissions.canRead===true}else{return false}},canAccessRestrictedComponents:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.restrictedComponentsPermissions.canWrite===true}else{return false}},canAccessComponentRestrictions:function(j){if(g.isDefinedAndNotNull(g.currentUser)){if(g.currentUser.restrictedComponentsPermissions.canWrite===true){return true}var i=function(m){if(g.isEmpty(g.currentUser.componentRestrictionPermissions)){return false}var l=false;f.each(g.currentUser.componentRestrictionPermissions,function(n,o){if(o.requiredPermission.id===m.id){if(o.permissions.canWrite===true){l=true;return false}}});return l};var k=true;if(g.isEmpty(j)){k=false}else{f.each(j,function(l,m){if(!i(m.requiredPermission)){k=false;return false}})}return k}else{return false}},canAccessCounters:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.countersPermissions.canRead===true}else{return false}},canModifyCounters:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.countersPermissions.canRead===true&&g.currentUser.countersPermissions.canWrite===true}else{return false}},canAccessTenants:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.tenantsPermissions.canRead===true}else{return false}},canModifyTenants:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.tenantsPermissions.canRead===true&&g.currentUser.tenantsPermissions.canWrite===true}else{return false}},canModifyParameterContexts:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.parameterContextPermissions.canRead===true&&g.currentUser.parameterContextPermissions.canWrite===true}else{return false}},canAccessPolicies:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.policiesPermissions.canRead===true}else{return false}},canModifyPolicies:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.policiesPermissions.canRead===true&&g.currentUser.policiesPermissions.canWrite===true}else{return false}},canAccessController:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.controllerPermissions.canRead===true}else{return false}},canModifyController:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.controllerPermissions.canRead===true&&g.currentUser.controllerPermissions.canWrite===true}else{return false}},canAccessSystem:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.systemPermissions.canRead===true}else{return false}},addHoverEffect:function(i,k,j){f(document).on("mouseenter",i,function(){f(this).removeClass(k).addClass(j)}).on("mouseleave",i,function(){f(this).removeClass(j).addClass(k)});return f(i).addClass(k)},toggleScrollable:function(i){if(f(i).is(":visible")){if(i.offsetHeight<i.scrollHeight||i.offsetWidth<i.scrollWidth){f(i).addClass("scrollable")}else{f(i).removeClass("scrollable")}}},determineContrastColor:function(i){if(parseInt(i,16)>16777215/1.5){return"#000000"}return"#ffffff"},updateLogoutLink:function(){if(b.hasToken()){f("#user-logout-container").css("display","block")}else{f("#user-logout-container").css("display","none")}},isContentViewConfigured:function(){var i=f("#nifi-content-viewer-url").text();return !g.isBlank(i)},populateField:function(j,i){if(g.isUndefined(i)||g.isNull(i)){return f("#"+j).addClass("unset").text("No value set")}else{if(i===""){return f("#"+j).addClass("blank").text("Empty string set")}else{return f("#"+j).text(i)}}},clearField:function(i){return f("#"+i).removeClass("unset blank").text("")},cleanUpTooltips:function(i,j){i.find(j).each(function(){var l=f(this);if(l.data("qtip")){var k=l.qtip("api");k.destroy(true)}})},formatPropertyTooltip:function(j,l){var m=[];if(g.isDefinedAndNotNull(j)){if(!g.isBlank(j.description)){m.push(g.escapeHtml(j.description))}if(!g.isBlank(j.defaultValue)){m.push("<b>Default value:</b> "+g.escapeHtml(j.defaultValue))}if(!g.isBlank(j.supportsEl)){m.push("<b>Expression language scope:</b> "+g.escapeHtml(j.expressionLanguageScope))}if(!g.isBlank(j.sensitive)){m.push("<b>Sensitive property:</b> "+g.escapeHtml(j.sensitive))}if(!g.isBlank(j.identifiesControllerService)){var i=g.formatType({type:j.identifiesControllerService,bundle:j.identifiesControllerServiceBundle});var k=g.formatBundle(j.identifiesControllerServiceBundle);m.push("<b>Requires Controller Service:</b> "+g.escapeHtml(i+" from "+k))}}if(g.isDefinedAndNotNull(l)){if(!g.isEmpty(l.previousValues)){var n=[];f.each(l.previousValues,function(p,o){n.push("<li>"+g.escapeHtml(o.previousValue)+" - "+g.escapeHtml(o.timestamp)+" ("+g.escapeHtml(o.userIdentity)+")</li>")});m.push('<b>History:</b><ul class="property-info">'+n.join("")+"</ul>")}}if(m.length>0){return m.join("<br/><br/>")}else{return null}},formatWhitespaceTooltip:function(){return g.escapeHtml("The specified value contains leading and/or trailing whitespace character(s). This could produce unexpected results if it was not intentional.")},LEAD_TRAIL_WHITE_SPACE_REGEX:/^[ \s]+|[ \s]+$/,hasLeadTrailWhitespace:function(i){if(g.isBlank(i)){return false}return g.LEAD_TRAIL_WHITE_SPACE_REGEX.test(i)},formatProperty:function(i,j){return'<div><span class="label">'+g.formatValue(i)+": </span>"+g.formatValue(j)+"</div>"},formatValue:function(i){if(g.isDefinedAndNotNull(i)){if(i===""){return'<span class="blank" style="font-size: 13px; padding-top: 2px;">Empty string set</span>'}else{return g.escapeHtml(i)}}else{return'<span class="unset" style="font-size: 13px; padding-top: 2px;">No value set</span>'}},escapeHtml:(function(){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2f;"};return function(j){if(g.isDefinedAndNotNull(j)){return String(j).replace(/[&<>"'\/]/g,function(k){return i[k]})}else{return""}}}()),isSensitiveProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.sensitive===true}else{return false}},isRequiredProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.required===true}else{return false}},isDynamicProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.dynamic===true}else{return false}},getAllowableValues:function(i){if(g.isDefinedAndNotNull(i)){return i.allowableValues}else{return null}},supportsEl:function(i){if(g.isDefinedAndNotNull(i)){return i.supportsEl===true}else{return false}},formatUnorderedList:function(j){if(f.isArray(j)){var i=f('<ul class="result"></ul>');f.each(j,function(l,m){var k=f("<li></li>").appendTo(i);if(m instanceof jQuery){k.append(m)}else{k.text(m)}});return i}else{return null}},substringAfterLast:function(m,l){var j="";var k=m.lastIndexOf(l);if(k>=0){var i=k+l.length;if(i<m.length){j=m.substr(i)}}return j},substringAfterFirst:function(m,l){var j="";var k=m.indexOf(l);if(k>=0){var i=k+l.length;if(i<m.length){j=m.substr(i)}}return j},substringBeforeLast:function(l,k){var i="";var j=l.lastIndexOf(k);if(j>=0){i=l.substr(0,j)}return i},substringBeforeFirst:function(l,k){var i="";var j=l.indexOf(k);if(j>=0){i=l.substr(0,j)}return i},setCursor:function(j,i){if(i){f("#"+j).addClass("pointer")}else{f("#"+j).removeClass("pointer")}},MILLIS_PER_DAY:86400000,MILLIS_PER_HOUR:3600000,MILLIS_PER_MINUTE:60000,MILLIS_PER_SECOND:1000,loadBalanceStrategyOptions:[{text:"Do not load balance",value:"DO_NOT_LOAD_BALANCE",description:"Do not load balance FlowFiles between nodes in the cluster."},{text:"Partition by attribute",value:"PARTITION_BY_ATTRIBUTE",description:"Determine which node to send a given FlowFile to based on the value of a user-specified FlowFile Attribute. All FlowFiles that have the same value for said Attribute will be sent to the same node in the cluster."},{text:"Round robin",value:"ROUND_ROBIN",description:"FlowFiles will be distributed to nodes in the cluster in a Round-Robin fashion. However, if a node in the cluster is not able to receive data as fast as other nodes, that node may be skipped in one or more iterations in order to maximize throughput of data distribution across the cluster."},{text:"Single node",value:"SINGLE_NODE",description:"All FlowFiles will be sent to the same node. Which node they are sent to is not defined."}],loadBalanceCompressionOptions:[{text:"Do not compress",value:"DO_NOT_COMPRESS",description:"FlowFiles will not be compressed"},{text:"Compress attributes only",value:"COMPRESS_ATTRIBUTES_ONLY",description:"FlowFiles' attributes will be compressed, but the FlowFiles' contents will not be"},{text:"Compress attributes and content",value:"COMPRESS_ATTRIBUTES_AND_CONTENT",description:"FlowFiles' attributes and content will be compressed"}],formatDuration:function(l){l=l<1?0:l;var n=l/g.MILLIS_PER_DAY;n=n>=1?parseInt(n,10):0;l%=g.MILLIS_PER_DAY;var i=l/g.MILLIS_PER_HOUR;i=i>=1?parseInt(i,10):0;l%=g.MILLIS_PER_HOUR;var j=l/g.MILLIS_PER_MINUTE;j=j>=1?parseInt(j,10):0;l%=g.MILLIS_PER_MINUTE;var m=l/g.MILLIS_PER_SECOND;m=m>=1?parseInt(m,10):0;l=Math.floor(l%g.MILLIS_PER_SECOND);var k=g.pad(i,2,"0")+":"+g.pad(j,2,"0")+":"+g.pad(m,2,"0")+"."+g.pad(l,3,"0");if(n>0){return n+" days and "+k}else{return k}},formatPredictedDuration:function(i){if(i===0){return"now"}return h.duration(i,"ms").humanize()},BYTES_IN_KILOBYTE:1024,BYTES_IN_MEGABYTE:1048576,BYTES_IN_GIGABYTE:1073741824,BYTES_IN_TERABYTE:1099511627776,formatDataSize:function(j){var i=parseFloat(j/g.BYTES_IN_TERABYTE);if(i>1){return i.toFixed(2)+" TB"}i=parseFloat(j/g.BYTES_IN_GIGABYTE);if(i>1){return i.toFixed(2)+" GB"}i=parseFloat(j/g.BYTES_IN_MEGABYTE);if(i>1){return i.toFixed(2)+" MB"}i=parseFloat(j/g.BYTES_IN_KILOBYTE);if(i>1){return i.toFixed(2)+" KB"}return parseFloat(j).toFixed(2)+" bytes"},formatInteger:function(j){var i=j+"";var k=/(\d+)(\d{3})/;while(k.test(i)){i=i.replace(k,"$1,$2")}return g.escapeHtml(i)},formatFloat:function(i){if(g.isUndefinedOrNull(i)){return 0+""}return i.toFixed(2)+""},pad:function(l,j,k){var i=l+"";while(i.length<j){i=k+i}return i},formatDateTime:function(i){return g.pad(i.getMonth()+1,2,"0")+"/"+g.pad(i.getDate(),2,"0")+"/"+g.pad(i.getFullYear(),2,"0")+" "+g.pad(i.getHours(),2,"0")+":"+g.pad(i.getMinutes(),2,"0")+":"+g.pad(i.getSeconds(),2,"0")+"."+g.pad(i.getMilliseconds(),3,"0")},parseDateTime:function(m){if(!g.isDefinedAndNotNull(m)){return new Date()}if(m==="No value set"){return new Date()}if(m==="Empty string set"){return new Date()}var t=m.split(/ /);if(t.length!==3){return new Date()}var j=t[0].split(/\//);var i=t[1].split(/:/);if(j.length!==3||i.length!==3){return new Date()}var o=parseInt(j[2],10);var n=parseInt(j[0],10)-1;var p=parseInt(j[1],10);var q=parseInt(i[0],10);var l=parseInt(i[1],10);var s=i[2].split(/\./);var r=parseInt(s[0],10);var k=0;if(s.length===2){k=parseInt(s[1],10)}return new Date(o,n,p,q,l,r,k)},parseDuration:function(i){var j=i.split(/:/);if(j.length!==3){return 0}var k=j[2].split(/\./);if(k.length===2){return new Date(1970,0,1,parseInt(j[0],10),parseInt(j[1],10),parseInt(k[0],10),parseInt(k[1],10)).getTime()}else{return new Date(1970,0,1,parseInt(j[0],10),parseInt(j[1],10),parseInt(j[2],10),0).getTime()}},parseSize:function(k){var l=k.split(/ /);var j=parseFloat(l[0].replace(/,/g,""));var i=l[1];if(i==="KB"){return j*1024}else{if(i==="MB"){return j*1024*1024}else{if(i==="GB"){return j*1024*1024*1024}else{if(i==="TB"){return j*1024*1024*1024*1024}else{return j}}}}},parseCount:function(k){var j=k.split(/ /,1);if(j.length!==1){return 0}var i=parseInt(j[0].replace(/,/g,""),10);if(isNaN(i)){return 0}return i},isDefinedAndNotNull:function(i){return !g.isUndefined(i)&&!g.isNull(i)},isUndefinedOrNull:function(i){return g.isUndefined(i)||g.isNull(i)},isUndefined:function(i){return typeof i==="undefined"},isBlank:function(i){return g.isUndefined(i)||g.isNull(i)||f.trim(i)===""},isNull:function(i){return i===null},isEmpty:function(i){return f.isArray(i)?i.length===0:true},doBulletinsDiffer:function(k,l){if(f.isArray(k)&&f.isArray(l)){if(k.length===l.length){for(var j=0;j<k.length;j++){if(k[j].id!==l[j].id||k[j].canRead!==l[j].canRead){return true}}}else{return true}}else{if(f.isArray(k)||f.isArray(l)){return true}}return false},getFormattedBulletins:function(j){var i=[];f.each(j,function(l,m){if(m.canRead===true){var k=m.bulletin;var p="";if(g.isDefinedAndNotNull(k.nodeAddress)){p="-&nbsp;"+g.escapeHtml(k.nodeAddress)+"&nbsp;-&nbsp;"}var o=f("<pre></pre>").css({"white-space":"pre-wrap"}).text(k.message);var n=f("<div>"+g.escapeHtml(k.timestamp)+"&nbsp;"+p+"&nbsp;<b>"+g.escapeHtml(k.level)+"</b>&nbsp;</div>").append(o);i.push(n)}});return i},getFormattedServiceApis:function(j){var i=[];f.each(j,function(m,n){var k=g.formatType({type:n.type,bundle:n.bundle});var l=g.formatBundle(n.bundle);i.push(f("<div></div>").text(k+" from "+l))});return i},getFormattedGarbageCollections:function(j){j.sort(function(l,k){return k.collectionCount-l.collectionCount});var i=[];f.each(j,function(m,k){var l=f('<span style="font-weight: bold;"></span>').text(k.name);var n=f("<span></span>").text(" - "+k.collectionCount+" times ("+k.collectionTime+")");var o=f("<div></div>").append(l).append(n);i.push(o)});return i},isGlobalPolicy:function(i){return g.getPolicyTypeListing(i)!==null},getPolicyTypeListing:function(i){return a.find(function(j){return i===j.value})},getComponentName:function(i){return i.permissions.canRead===true?i.component.name:i.id},getComboOptionText:function(i,k){var j=i.find(function(l){return l.value===k});return g.isDefinedAndNotNull(j)?j.text:undefined},throttle:function(i,j){return c.throttle(i,j)},getKeyValue:function(j,i){return i.split(".").reduce(function(l,k){return(typeof l===undefined||l===null)?l:(typeof l[k]=="function")?l[k]():l[k]},j)},isMultiLine:function(i){const j=/\n/.exec(i);if(j){return true}return false}};return g}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Dialog","nf.Common","nf.AuthorizationStorage"],function(e,d,f,c){return(nf.ErrorHandler=b(e,d,f,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ErrorHandler=b(require("jquery"),require("nf.Dialog"),require("nf.Common"),require("nf.AuthorizationStorage")))}else{nf.ErrorHandler=b(a.$,a.nf.Dialog,a.nf.Common,a.nf.AuthorizationStorage)}}}(this,function(d,c,e,b){var a={handleAjaxError:function(k,f,g){if(f==="canceled"){b.removeToken();if(d("#splash").is(":visible")){d("#message-title").text("Session Expired");d("#message-content").text("Your session has expired. Please reload to log in again.");d("#message-pane").show()}else{c.showOkDialog({headerText:"Session Expired",dialogContent:"Your session has expired. Please press Ok to log in again.",okHandler:function(){window.location="../nifi/"}})}return}var i=k.getResponseHeader("WWW-Authenticate");var j=new RegExp("^Bearer.*$");if(j.test(i)){b.removeToken()}if(d("#splash").is(":visible")){if(k.status===401){d("#message-title").text("Unauthorized")}else{if(k.status===403){d("#message-title").text("Insufficient Permissions")}else{if(k.status===409){d("#message-title").text("Invalid State")}else{if(k.status===413){d("#message-title").text("Payload Too Large")}else{d("#message-title").text("An unexpected error has occurred")}}}}if(d.trim(k.responseText)===""){d("#message-content").text("Please check the logs.")}else{d("#message-content").text(k.responseText)}d("#message-pane").show();return}if(k.status===400||k.status===404||k.status===409||k.status==413||k.status===503){c.showOkDialog({headerText:"Error",dialogContent:e.escapeHtml(k.responseText)})}else{if(k.status===403){c.showOkDialog({headerText:"Insufficient Permissions",dialogContent:e.escapeHtml(k.responseText)})}else{if(k.status<99||k.status===12007||k.status===12029){var h="Please ensure the application is running and check the logs for any errors.";if(e.isDefinedAndNotNull(f)){if(f==="timeout"){h="Request has timed out. Please ensure the application is running and check the logs for any errors."}else{if(f==="abort"){h="Request has been aborted."}else{if(f==="No Transport"){h="Request transport mechanism failed. Please ensure the host where the application is running is accessible."}}}}d("#message-title").text("Unable to communicate with NiFi");d("#message-content").text(h)}else{if(k.status===401){d("#message-title").text("Unauthorized");if(d.trim(k.responseText)===""){d("#message-content").text("Authentication is required to use this NiFi.")}else{d("#message-content").text(k.responseText)}}else{if(k.status===500){d("#message-title").text("An unexpected error has occurred");if(d.trim(k.responseText)===""){d("#message-content").text("An error occurred communicating with the application core. Please check the logs and fix any configuration issues before restarting.")}else{d("#message-content").text(k.responseText)}}else{if(k.status===200||k.status===201){d("#message-title").text("Parse Error");if(d.trim(k.responseText)===""){d("#message-content").text("Unable to interpret response from NiFi.")}else{d("#message-content").text(k.responseText)}}else{d("#message-title").text(k.status+": Unexpected Response");d("#message-content").text("An unexpected error has occurred. Please check the logs.")}}}}d("#message-pane").show()}}},handleConfigurationUpdateAjaxError:function(i,f,g){if(i.status===400){var j=i.responseText.split("\n");var h;if(j.length===1){h=d("<span></span>").text(j[0])}else{h=e.formatUnorderedList(j)}c.showOkDialog({dialogContent:h,headerText:"Configuration Error"})}else{a.handleAjaxError(i,f,g)}}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.UniversalCapture=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.UniversalCapture=b(require("jquery")))}else{nf.UniversalCapture=b(a.$)}}}(this,function(b){b(document).ready(function(c){c(window).on("keydown",function(d){var i=d.ctrlKey||d.metaKey;if(!i&&d.keyCode===27){var g=c("div.value-combo");if(g.is(":visible")&&g.parent().hasClass("combo-editor")){return}if(c("div.property-detail").is(":visible")){a.removeAllPropertyDetailDialogs();d.stopImmediatePropagation();d.preventDefault()}else{var h=c(d.target);if(h.length){var j=c(".cancellable");if(j.length){var e=null;var f=null;c.each(j,function(k,m){var l=c(m);var n=l.css("zIndex");if(l.is(":visible")&&(n!==null&&typeof n!=="undefined")){n=parseInt(n,10);if(e===null||n>e){e=n;f=l}}});if(f!==null){if(f.hasClass("modal")){f.modal("hide")}else{f.hide()}d.stopImmediatePropagation();d.preventDefault();return}}if(top!==window){if(typeof parent.nf!=="undefined"&&typeof parent.nf.Shell!=="undefined"){parent.$("#shell-close-button").click();d.stopImmediatePropagation();d.preventDefault();return}}}}}else{if(i){if(d.keyCode===82){d.preventDefault()}}else{if(!c("input, textarea").is(":focus")&&(d.keyCode==8||d.keyCode===46)){d.preventDefault()}}}})});var a={removeAllPropertyDetailDialogs:function(){var c=b("body").find("div.property-detail");c.find("div.nf-editor").nfeditor("destroy");c.find("div.value-combo").combo("destroy");c.hide().remove()}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.AuthorizationStorage"],function(d,c){return(nf.AjaxSetup=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.AjaxSetup=b(require("jquery"),require("nf.AuthorizationStorage")))}else{nf.AjaxSetup=b(a.$,a.nf.AuthorizationStorage)}}}(this,function(b,a){b(document).ready(function(c){c.ajaxSetup({beforeSend:function(e){var d=a.getRequestToken();if(d!==null){e.setRequestHeader("Request-Token",d)}}})})}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.Client","nf.ErrorHandler"],function(d,g,e,c,f){return(nf.UsersTable=b(d,g,e,c,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.UsersTable=b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.Client"),require("nf.ErrorHandler")))}else{nf.UsersTable=b(a.$,a.Slick,a.nf.Common,a.nf.Client,a.nf.ErrorHandler)}}}(this,function(y,b,H,n,f){var w=false;var E={urls:{users:"../nifi-api/tenants/users",userGroups:"../nifi-api/tenants/user-groups"}};var v=function(N){var O=y("#users-table").data("gridInstance");var P=O.getData();return P.getItemById("user_"+N)};var d=function(N){var O=y("#users-table").data("gridInstance");var P=O.getData();return P.getItemById("group_"+N)};var I=function(O,R){var N=y("#users-table").data("gridInstance");var P=N.getData();var Q=P.getRowById(O+"_"+R);N.setSelectedRows([Q]);N.scrollRowIntoView(Q)};var D=function(){y("#user-delete-dialog").modal({headerText:"Delete Account",buttons:[{buttonText:"Delete",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var Q=y("#user-extended-id-delete-dialog").val();var P=y("#users-table").data("gridInstance");var R=P.getData();var N=R.getItemById(Q);var O=n.getRevision(N);y.ajax({type:"DELETE",url:N.uri+"?"+y.param(y.extend({disconnectedNodeAcknowledged:w},O)),dataType:"json"}).done(function(){m.loadUsersTable()}).fail(f.handleAjaxError);y("#user-delete-dialog").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){y("#user-delete-dialog").modal("hide")}}}],handler:{close:function(){y("#user-extended-id-delete-dialog").val("");y("#user-name-delete-dialog").text("")}}})};var C=function(){var N=[];y("#available-groups div.group-check").filter(function(){return y(this).hasClass("checkbox-checked")}).each(function(){var O=y(this).next("span.group-id").text();N.push({id:O})});return N};var c=function(){var N=[];y("#available-users div.user-check").filter(function(){return y(this).hasClass("checkbox-checked")}).each(function(){var O=y(this).next("span.user-id").text();N.push({id:O})});return N};var t=function(P,O){var N=[];y.each(P.component.users,function(R,S){N.push({id:S.id})});N.push({id:O.id});var Q={revision:n.getRevision(P),disconnectedNodeAcknowledged:w,component:y.extend({},P.component,{users:N})};return y.ajax({type:"PUT",url:P.uri,data:JSON.stringify(Q),dataType:"json",contentType:"application/json"})};var p=function(P,O){var N=[];y.each(P.component.users,function(R,S){if(S.id!==O.id){N.push({id:S.id})}});var Q={revision:n.getRevision(P),disconnectedNodeAcknowledged:w,component:y.extend({},P.component,{users:N})};return y.ajax({type:"PUT",url:P.uri,data:JSON.stringify(Q),dataType:"json",contentType:"application/json"})};var K=function(O,N){var P=y.ajax({type:"POST",url:E.urls.users,data:JSON.stringify(O),dataType:"json",contentType:"application/json"});P.done(function(Q){y("#user-dialog").modal("hide");var R=[];y.each(N,function(S,T){var U=d(T.id);R.push(t(U,Q))});y.when.apply(window,R).always(function(){m.loadUsersTable().done(function(){I("user",Q.id)})}).fail(f.handleAjaxError)}).fail(f.handleConfigurationUpdateAjaxError)};var F=function(R,Q,N){var P=v(R);var S={revision:n.getRevision(P),disconnectedNodeAcknowledged:w,component:{id:R,identity:Q}};var O=y.ajax({type:"PUT",url:P.uri,data:JSON.stringify(S),dataType:"json",contentType:"application/json"});O.done(function(W){y("#user-dialog").modal("hide");var T=[];var U=[];y.each(W.component.userGroups,function(Y,Z){var X=y.grep(N,function(aa){return aa.id===Z.id});if(X.length===0){U.push(Z)}});y.each(N,function(Y,Z){var X=y.grep(W.component.userGroups,function(aa){return aa.id===Z.id});if(X.length===0){T.push(Z)}});var V=[];y.each(T,function(X,Z){var Y=d(Z.id);V.push(t(Y,W))});y.each(U,function(X,Z){var Y=d(Z.id);V.push(p(Y,W))});y.when.apply(window,V).always(function(){m.loadUsersTable()}).fail(f.handleAjaxError)}).fail(f.handleConfigurationUpdateAjaxError)};var e=function(N){y.ajax({type:"POST",url:E.urls.userGroups,data:JSON.stringify(N),dataType:"json",contentType:"application/json"}).done(function(O){y("#user-dialog").modal("hide");m.loadUsersTable().done(function(){I("group",O.id)})}).fail(f.handleConfigurationUpdateAjaxError)};var j=function(O,N,Q){var P=d(O);var R={revision:n.getRevision(P),disconnectedNodeAcknowledged:w,component:{id:O,identity:N,users:Q}};y.ajax({type:"PUT",url:P.uri,data:JSON.stringify(R),dataType:"json",contentType:"application/json"}).done(function(S){y("#user-dialog").modal("hide");m.loadUsersTable()}).fail(f.handleConfigurationUpdateAjaxError)};var i=function(){y("#user-dialog").modal({headerText:"User/Group",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var P=y("#user-id-edit-dialog").text();var O=y("#user-identity-edit-dialog").val();if(y.trim(P)===""){var N={revision:n.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:w};if(y("#individual-radio-button").is(":checked")){N.component={identity:O};K(N,C())}else{N.component={identity:O,users:c()};e(N)}}else{if(y("#individual-radio-button").is(":checked")){F(P,O,C())}else{j(P,O,c())}}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){y("#user-dialog").modal("hide")}}}],handler:{close:function(){y('#user-dialog input[name="userOrGroup"]').attr("disabled",false);y("#individual-radio-button").prop("checked",true);y("#user-groups").show();y("#group-members").hide();y("#user-id-edit-dialog").text("");y("#user-identity-edit-dialog").val("");y("#available-users").empty();y("#available-groups").empty()}}});y('#user-dialog input[name="userOrGroup"]').on("change",function(){if(y(this).val()==="individual"){y("#user-groups").show();y("#group-members").hide()}else{y("#user-groups").hide();y("#group-members").show()}})};var s=function(){y("#user-policies-dialog").modal({headerText:"User Policies",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){y("#user-policies-dialog").modal("hide")}}}]})};var L=function(N){return"Global policy to "+N.text};var o=function(N){return'<span class="unset">Unknown resource '+H.escapeHtml(N.component.resource)+"</span>"};var G=function(N){var P=N.component.resource;if(P==="/restricted-components"){return"Restricted components regardless of restrictions"}var O=H.substringAfterFirst(P,"/restricted-components/");return"Restricted components requiring '"+H.escapeHtml(O)+"'"};var M=function(N){var P=N.component.resource;var O="";if(P.startsWith("/policies")){P=H.substringAfterFirst(P,"/policies");O+="Admin policy for "}else{if(P.startsWith("/data-transfer")){P=H.substringAfterFirst(P,"/data-transfer");O+="Site to site policy for "}else{if(P.startsWith("/data")){P=H.substringAfterFirst(P,"/data");O+="Data policy for "}else{if(P.startsWith("/operation")){P=H.substringAfterFirst(P,"/operation");O+="Operate policy for "}else{O+="Component policy for "}}}}if(P.startsWith("/processors")){O+="processor "}else{if(P.startsWith("/controller-services")){O+="controller service "}else{if(P.startsWith("/funnels")){O+="funnel "}else{if(P.startsWith("/input-ports")){O+="input port "}else{if(P.startsWith("/labels")){O+="label "}else{if(P.startsWith("/output-ports")){O+="output port "}else{if(P.startsWith("/process-groups")){O+="process group "}else{if(P.startsWith("/remote-process-groups")){O+="remote process group "}else{if(P.startsWith("/reporting-tasks")){O+="reporting task "}else{if(P.startsWith("/templates")){O+="template "}else{if(P.startsWith("/parameter-contexts")){O+="parameter context "}}}}}}}}}}}if(N.component.componentReference.permissions.canRead===true){O+='<span style="font-weight: 500">'+H.escapeHtml(N.component.componentReference.component.name)+"</span>"}else{O+='<span class="unset">'+H.escapeHtml(N.component.componentReference.id)+"</span>"}return O};var u=function(){var P=function(Y,V,X,W,U){if(U.permissions.canRead===true){return J(U)}else{return'<span class="unset">'+H.escapeHtml(U.id)+"</span>"}};var S=function(Z,V,Y,X,U){var W="";if(U.permissions.canRead===true){if(H.isDefinedAndNotNull(U.component.componentReference)){if(U.component.resource.indexOf("/processors")>=0){W+='<div title="Go To" class="pointer go-to-component fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/controller-services")>=0){}else{if(U.component.resource.indexOf("/funnels")>=0){W+='<div title="Go To" class="pointer go-to-component fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/input-ports")>=0){W+='<div title="Go To" class="pointer go-to-component fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/labels")>=0){W+='<div title="Go To" class="pointer go-to-component fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/output-ports")>=0){W+='<div title="Go To" class="pointer go-to-component fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/process-groups")>=0){W+='<div title="Go To" class="pointer go-to-process-group fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/remote-process-groups")>=0){W+='<div title="Go To" class="pointer go-to-component fa fa-long-arrow-right" style="float: left;"></div>'}else{if(U.component.resource.indexOf("/reporting-tasks")>=0){}else{if(U.component.resource.indexOf("/templates")>=0){}else{if(U.component.resource.indexOf("/parameter-contexts")>=0){W+='<div title="Go To" class="pointer go-to-parameter-context fa fa-long-arrow-right" style="float: left;"></div>'}}}}}}}}}}}}}return W};var R=function(Z,V,Y,X,U){var W="";if(U.permissions.canRead===true){W+=U.component.action}return H.escapeHtml(W)};var O=[{id:"policy",name:"Policy",sortable:true,resizable:true,formatter:P,width:150},{id:"action",name:"Action",sortable:true,resizable:false,formatter:R,width:50}];if(top!==window){O.push({id:"actions",name:"&nbsp;",sortable:false,resizable:false,formatter:S,width:25})}var N={autosizeColsMode:b.GridAutosizeColsMode.LegacyForceFit,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false};var T=new b.Data.DataView({inlineFilters:false});T.setItems([]);x({columnId:"policy",sortAsc:true},T);var Q=new b.Grid("#user-policies-table",T,O,N);Q.setSelectionModel(new b.RowSelectionModel());Q.registerPlugin(new b.AutoTooltips());Q.setSortColumn("policy",true);Q.onSort.subscribe(function(V,U){x({columnId:U.sortCol.id,sortAsc:U.sortAsc},T)});Q.onClick.subscribe(function(X,U){var W=y(X.target);var V=T.getItem(U.row);if(Q.getColumns()[U.cell].id==="actions"){if(W.hasClass("go-to-component")){parent.$("body").trigger("GoTo:Component",{id:V.component.componentReference.id,parentGroupId:V.component.componentReference.parentGroupId});parent.$("#shell-close-button").click()}else{if(W.hasClass("go-to-process-group")){parent.$("body").trigger("GoTo:ProcessGroup",{id:V.component.componentReference.id});parent.$("#shell-close-button").click()}else{if(W.hasClass("go-to-parameter-context")){parent.$("body").trigger("GoTo:ParameterContext",{id:V.component.componentReference.id});parent.$("#shell-close-button").click()}}}}});T.onRowCountChanged.subscribe(function(V,U){Q.updateRowCount();Q.render()});T.onRowsChanged.subscribe(function(V,U){Q.invalidateRows(U.rows);Q.render()});y("#user-policies-table").data("gridInstance",Q)};var r=function(O){y("#users-filter").keyup(function(){q()});y("#users-filter-type").combo({options:[{text:"by user",value:"identity"}],select:function(V){q()}});var N=function(aa,W,Z,Y,V){var X="";if(V.type==="group"){X+='<div class="fa fa-users"></div>'}X+=H.escapeHtml(V.component.identity);return X};var Q=function(Z,W,Y,X,V){if(V.type==="group"){return"Members: <b>"+V.component.users.map(function(aa){return H.escapeHtml(aa.component.identity)}).join("</b>, <b>")+"</b>"}else{return"Member of: <b>"+V.component.userGroups.map(function(aa){return H.escapeHtml(aa.component.identity)}).join("</b>, <b>")+"</b>"}};var T=function(aa,W,Z,Y,V){var X="";if(O&&V.component.configurable===true&&H.canModifyTenants()){X+='<div title="Edit" class="pointer edit-user fa fa-pencil"></div>';X+='<div title="Remove" class="pointer delete-user fa fa-trash"></div>'}if(!H.isEmpty(V.component.accessPolicies)){X+='<div title="View User Policies" class="pointer view-user-policies fa fa-key" style="margin-left: 3px;"></div>'}return X};var R=[{id:"identity",name:"User",sortable:true,resizable:true,formatter:N},{id:"membersGroups",name:"&nbsp;",sortable:true,defaultSortAsc:false,resizable:true,formatter:Q},{id:"actions",name:"&nbsp;",sortable:false,resizable:false,formatter:T,width:100,maxWidth:100}];var P={autosizeColsMode:b.GridAutosizeColsMode.LegacyForceFit,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false};var U=new b.Data.DataView({inlineFilters:false});U.setItems([],"extendedId");U.setFilterArgs({searchString:z(),property:y("#users-filter-type").combo("getSelectedOption").value});U.setFilter(A);l({columnId:"identity",sortAsc:true},U);var S=new b.Grid("#users-table",U,R,P);S.setSelectionModel(new b.RowSelectionModel());S.registerPlugin(new b.AutoTooltips());S.setSortColumn("identity",true);S.onSort.subscribe(function(W,V){l({columnId:V.sortCol.id,sortAsc:V.sortAsc},U)});S.onClick.subscribe(function(Y,V){var X=y(Y.target);var W=U.getItem(V.row);if(S.getColumns()[V.cell].id==="actions"){if(X.hasClass("edit-user")){a(W)}else{if(X.hasClass("view-user-policies")){g(W)}else{if(X.hasClass("delete-user")){k(W)}}}}});U.onRowCountChanged.subscribe(function(W,V){S.updateRowCount();S.render();y("#displayed-users").text(V.current)});U.onRowsChanged.subscribe(function(W,V){S.invalidateRows(V.rows);S.render()});y("#users-table").data("gridInstance",S);y("#displayed-users").text("0")};var l=function(N,P){var O=function(S,Q){if(S.permissions.canRead&&Q.permissions.canRead){var R=H.isDefinedAndNotNull(S.component[N.columnId])?S.component[N.columnId]:"";var T=H.isDefinedAndNotNull(Q.component[N.columnId])?Q.component[N.columnId]:"";return R===T?0:R>T?1:-1}else{if(!S.permissions.canRead&&!Q.permissions.canRead){return 0}if(S.permissions.canRead){return 1}else{return -1}}};P.sort(O,N.sortAsc)};var J=function(N){if(N.component.resource.startsWith("/restricted-components")){return G(N)}else{if(H.isDefinedAndNotNull(N.component.componentReference)){return M(N)}else{var O=H.getPolicyTypeListing(H.substringAfterFirst(N.component.resource,"/"));if(H.isDefinedAndNotNull(O)){return L(O)}else{return o(N)}}}};var x=function(N,P){var O=function(S,Q){if(S.permissions.canRead&&Q.permissions.canRead){if(N.columnId==="action"){var R=H.isDefinedAndNotNull(S.component[N.columnId])?S.component[N.columnId]:"";var T=H.isDefinedAndNotNull(Q.component[N.columnId])?Q.component[N.columnId]:"";return R===T?0:R>T?1:-1}else{if(N.columnId==="policy"){var R="";var T="";if(S.permissions.canRead===true){R=J(S)}else{R=S.id}if(Q.permissions.canRead===true){T=J(Q)}else{T=Q.id}return R===T?0:R>T?1:-1}}}else{if(!S.permissions.canRead&&!Q.permissions.canRead){return 0}if(S.permissions.canRead){return 1}else{return -1}}};P.sort(O,N.sortAsc)};var z=function(){return y("#users-filter").val()};var q=function(){var N=y("#users-table").data("gridInstance");if(H.isDefinedAndNotNull(N)){var O=N.getData();O.setFilterArgs({searchString:z(),property:y("#users-filter-type").combo("getSelectedOption").value});O.refresh()}};var A=function(O,N){if(N.searchString===""){return true}try{var Q=new RegExp(N.searchString,"i")}catch(P){return false}return O.component[N.property].search(Q)>=0};var h=function(){var N=y("#users-table").data("gridInstance");var Q=N.getData();var P=y("#available-users");var O=0;y.each(Q.getItems(),function(V,U){if(U.type==="user"){var X=y('<div class="user-check nf-checkbox checkbox-unchecked"></div>').addClass("group-user-"+U.id);var W=y('<span class="user-id hidden"></span>').text(U.id);var T=y('<div class="available-identities nf-checkbox-label"></div>').text(U.component.identity);var S=y('<div class="clear"></div>');var R=y("<li></li>").append(X).append(W).append(T).append(S).appendTo(P);if(O++%2===0){R.addClass("even")}}})};var B=function(){var N=y("#users-table").data("gridInstance");var P=N.getData();var Q=y("#available-groups");var O=0;y.each(P.getItems(),function(V,Y){if(Y.type==="group"){var X=y('<div class="group-check nf-checkbox checkbox-unchecked"></div>').addClass("user-group-"+Y.id);var W=y('<span class="group-id hidden"></span>').text(Y.id);var T=y('<div class="fa fa-users nf-checkbox-label"></div>');var U=y('<div class="available-identities nf-checkbox-label"></div>').text(Y.component.identity);var S=y('<div class="clear"></div>');var R=y("<li></li>").append(X).append(W).append(T).append(U).append(S).appendTo(Q);if(O++%2===0){R.addClass("even")}}})};var a=function(N){y("#user-id-edit-dialog").text(N.id);y("#user-identity-edit-dialog").val(N.component.identity);if(N.type==="user"){y("#individual-radio-button").prop("checked",true);y("#user-groups").show();y("#group-members").hide();B();y.each(N.component.userGroups,function(O,P){y("div.group-check.user-group-"+P.id).removeClass("checkbox-unchecked").addClass("checkbox-checked")})}else{y("#group-radio-button").prop("checked",true);y("#user-groups").hide();y("#group-members").show();h();y.each(N.component.users,function(O,P){y("div.user-check.group-user-"+P.id).removeClass("checkbox-unchecked").addClass("checkbox-checked")})}y('#user-dialog input[name="userOrGroup"]').attr("disabled",true);y("#user-dialog").modal("show")};var k=function(N){y("#user-extended-id-delete-dialog").val(N.extendedId);y("#user-identity-delete-dialog").text(N.component.identity);y("#user-delete-dialog").modal("show")};var g=function(N){var O=y("#user-policies-table").data("gridInstance");var P=O.getData();P.beginUpdate();if(H.isDefinedAndNotNull(N.component.accessPolicies)){P.setItems(N.component.accessPolicies)}y("#policies-dialog-user-name").text(N.component.identity);P.endUpdate();P.reSort();O.invalidate();O.getSelectionModel().setSelectedRows([]);y("#user-policies-dialog").modal("show");O.resizeCanvas()};var m={init:function(N,O){w=O;i();s();u();D();r(N);if(N){y("#new-user-button").show();if(H.canModifyTenants()){y("#new-user-button").on("click",function(){h();B();y("#user-dialog").modal("show");y("#user-identity-edit-dialog").focus()});y("#new-user-button").prop("disabled",false)}else{y("#new-user-button").prop("disabled",true)}}},resetTableSize:function(){var N=y("#users-table");if(N.is(":visible")){var O=N.data("gridInstance");if(H.isDefinedAndNotNull(O)){O.resizeCanvas()}}},loadUsersTable:function(){var O=y.ajax({type:"GET",url:E.urls.users,dataType:"json"});var N=y.ajax({type:"GET",url:E.urls.userGroups,dataType:"json"});return y.when(O,N).done(function(Q,P){var V=Q[0];var T=P[0];y("#users-last-refreshed").text(V.generated);var R=y("#users-table").data("gridInstance");var S=R.getData();S.beginUpdate();var U=[];y.each(V.users,function(X,W){U.push(y.extend({extendedId:"user_"+W.id,type:"user"},W))});y.each(T.userGroups,function(W,X){U.push(y.extend({extendedId:"group_"+X.id,type:"group"},X))});S.setItems(U,"extendedId");S.endUpdate();S.reSort();R.invalidate();R.getSelectionModel().setSelectedRows([]);y("#total-users").text(S.getLength())}).fail(f.handleAjaxError)}};return m}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.Dialog","nf.UsersTable","nf.ErrorHandler","nf.Storage","nf.Client"],function(f,g,e,i,h,d,c){return(nf.Users=b(f,g,e,i,h,d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Users=b(require("jquery"),require("nf.Common"),require("nf.Dialog"),require("nf.UsersTable"),require("nf.ErrorHandler"),require("nf.Storage"),require("nf.Client")))}else{nf.Users=b(a.$,a.nf.Common,a.nf.Dialog,a.nf.UsersTable,a.nf.ErrorHandler,a.nf.Storage,a.nf.Client)}}}(this,function(g,d,e,a,i,h,m){g(document).ready(function(){j.init();if(top===window){g("#users").css("top",20);g("#users-refresh-container").css("bottom",20)}});var b={urls:{banners:"../nifi-api/flow/banners",controllerAbout:"../nifi-api/flow/about",currentUser:"../nifi-api/flow/current-user",flowConfig:"../nifi-api/flow/config"}};var c=function(){return g.ajax({type:"GET",url:b.urls.currentUser,dataType:"json"}).done(function(n){d.setCurrentUser(n)}).fail(i.handleAjaxError)};var l=function(){return g.ajax({type:"GET",url:b.urls.flowConfig,dataType:"json"}).fail(i.handleAjaxError)};var f=function(){return g.Deferred(function(n){if(top!==window&&d.isDefinedAndNotNull(parent.nf)&&d.isDefinedAndNotNull(parent.nf.Storage)){n.resolve(parent.nf.Storage.isDisconnectionAcknowledged())}else{g.ajax({type:"GET",url:"../nifi-api/flow/cluster/summary",dataType:"json"}).done(function(o){var p=o;var q=p.clusterSummary;if(q.connectedToCluster){n.resolve(false)}else{if(q.clustered){e.showDisconnectedFromClusterMessage(function(){n.resolve(true)})}else{n.resolve(false)}}}).fail(i.handleAjaxError).fail(function(){n.reject()})}}).promise()};var k=function(){d.addHoverEffect("#user-refresh-button","button-refresh","button-refresh-hover").click(function(){a.loadUsersTable()});return g.Deferred(function(n){if(top===window){g.ajax({type:"GET",url:b.urls.banners,dataType:"json"}).done(function(s){if(d.isDefinedAndNotNull(s.banners)){if(d.isDefinedAndNotNull(s.banners.headerText)&&s.banners.headerText!==""){var p=g("#banner-header").text(s.banners.headerText).show();var r=function(t){var u=g("#"+t);u.css("top",(parseInt(p.css("height"),10)+parseInt(u.css("top"),10))+"px")};r("users")}if(d.isDefinedAndNotNull(s.banners.footerText)&&s.banners.footerText!==""){var o=g("#banner-footer").text(s.banners.footerText).show();var q=function(t){var u=g("#"+t);u.css("bottom",parseInt(o.css("height"),10)+"px")};q("users")}}n.resolve()}).fail(function(q,o,p){i.handleAjaxError(q,o,p);n.reject()})}else{n.resolve()}})};var j={init:function(){h.init();m.init();g.when(l(),f(),c()).done(function(p,o){var q=p[0];var n=q.flowConfiguration;a.init(n.supportsConfigurableUsersAndGroups,o);a.loadUsersTable().done(function(){k().done(function(){g(window).resize(a.resetTableSize);a.resetTableSize();g.ajax({type:"GET",url:b.urls.controllerAbout,dataType:"json"}).done(function(s){var r=s.about;var t=r.title+" Users";document.title=t;g("#users-header-text").text(t)}).fail(i.handleAjaxError)});g(window).on("resize",function(w){var v=g(".dialog");for(var t=0,r=v.length;t<r;t++){if(g(v[t]).is(":visible")){setTimeout(function(x){x.modal("resize")},50,g(v[t]))}}var u=g('*[class*="slickgrid_"]');for(var s=0,r=u.length;s<r;s++){if(g(u[s]).is(":visible")){setTimeout(function(x){x.data("gridInstance").resizeCanvas()},50,g(u[s]))}}})})})}};return j}));
