(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.UniversalCapture","nf.Dialog","nf.Storage","nf.Client","nf.ErrorHandler","nf.ProcessGroup","nf.ProcessGroupConfiguration","nf.Settings","nf.ParameterContexts","lodash"],function(i,f,g,k,h,j,o,l,c,d,e,m,n){b(i,f,g,k,h,j,o,l,c,d,e,m,n)})}else{if(typeof exports==="object"&&typeof module==="object"){b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.UniversalCapture"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.ErrorHandler"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration"),require("nf.Settings"),recuire("nf.ParameterContexts"),require("lodash"))}else{b(a.$,a.Slick,a.nf.Common,a.nf.UniversalCapture,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.ErrorHandler,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration,a.nf.Settings,a.nf.ParameterContexts,a._)}}}(this,function(w,a,F,b,h,p,e,c,t,z,C,J,M){var H=null;var K=false;var s=null;var g=212;var L=212;var E=100;var N="<div>Expression Language (EL) supported</div>";var q='<div>After beginning with the start delimiter <span class="hint-pattern">${</span> use the keystroke <span class="hint-keystroke">control+space</span> to see a list of available functions.</div>';var k="<div>Expression Language (EL) not supported</div>";var d="<div>Parameters (PARAM) supported</div>";var i='<div>After beginning with the start delimiter <span class="hint-pattern">#{</span> use the keystroke <span class="hint-keystroke">control+space</span> to see a list of available parameters.</div>';var j="<div>Parameters (PARAM) not supported</div>";var l=function(O){if(F.isDefinedAndNotNull(O)){return O.startsWith("#{")&&O.endsWith("}")}return false};var u=function(P){var O=/#{[a-zA-Z0-9-_. ]+}/;return O.test(P)};var I=function(P,R){var S=w("<div></div>");var Q=w("<div></div>").addClass("mode-hint-tip-title-container").appendTo(S);if(R){w("<div></div>").addClass("fa fa-check").appendTo(Q);w(P?N:d).addClass("mode-supported").appendTo(Q);var O=w("<div></div>").addClass("mode-hint-tip-description-container").appendTo(S);w(P?q:i).appendTo(O)}else{w("<div></div>").addClass("fa fa-ban").appendTo(Q);w(P?k:j).addClass("mode-unsupported").appendTo(Q)}return S};var f=function(O){return function(U){var X=this;var W="";var Q;var T;var R;var P;var S;var V;this.init=function(){var Y=w("body");var ac=w(U.grid.getContainerNode());var al=ac.data("descriptors");T=al[U.item.property];var ad=O(T);var af=F.isSensitiveProperty(T);Q=U.item[U.column.field];P=w("<div></div>").addClass("slickgrid-nf-editor").css({"z-index":14000,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)"}).draggable({cancel:".button, .mode-hint-element, .nf-editor, .string-check-container > *",containment:"parent"}).appendTo(Y);V=w("<div></div>").addClass("mode-hint-tip").appendTo(Y);var ae=ad.supportsEl();var ak=ad.supportsParameterReference();V.append(I(true,ae));V.append(I(false,ak));var ab=w("<div></div>").addClass("mode-hint-container").appendTo(P);var ag=w("<div></div>").addClass("mode-hint-element").on("mouseenter",function(){var ap=P.position();var ao=ap.top-V.outerHeight()+2;var an=ap.left+P.outerWidth()-V.outerWidth()+5;V.css({top:ao+"px",left:an+"px"});V.show()}).on("mouseleave",function(){V.hide()}).appendTo(ab);var ai=w("<div></div>").addClass("mode-hint").appendTo(ag);w("<div>EL</div>").appendTo(ai);w("<div></div>").addClass("mode-hint-value fa").addClass(ae?"fa-check":"fa-ban").appendTo(ai);var aj=w("<div></div>").addClass("mode-hint").appendTo(ag);w("<div>PARAM</div>").appendTo(aj);w("<div></div>").addClass("mode-hint-value fa").addClass(ak?"fa-check":"fa-ban").appendTo(aj);var aa=Math.max(U.position.width,L);S=w("<div></div>").addClass("nf-editor").appendTo(P).nfeditor({languageMode:ad,width:aa,minWidth:L,minHeight:E,resizable:true,sensitive:af,escape:function(){X.cancel()},enter:function(){X.save()}});var Z=w('<div class="string-check-container" />');Z.appendTo(P);R=w('<div class="nf-checkbox string-check" />').on("change",function(ao,an){if(an.isChecked){S.nfeditor("setValue","");S.nfeditor("setReadOnly","nocursor")}else{S.nfeditor("setValue",W);S.nfeditor("setReadOnly",false)}}).appendTo(Z);w('<span class="string-check-label nf-checkbox-label">&nbsp;Set empty string</span>').appendTo(Z);var ah=w('<div class="button">Ok</div>').css({color:"#fff",background:"#728E9B"}).hover(function(){w(this).css("background","#004849")},function(){w(this).css("background","#728E9B")}).on("click",X.save);var am=w('<div class="secondary-button">Cancel</div>').css({color:"#004849",background:"#E3E8EB"}).hover(function(){w(this).css("background","#C7D2D7")},function(){w(this).css("background","#E3E8EB")}).on("click",X.cancel);w("<div></div>").css({position:"relative",top:"10px",left:"20px",width:"212px",clear:"both","float":"right"}).append(ah).append(am).append('<div class="clear"></div>').appendTo(P);X.position(U.position);S.nfeditor("focus").nfeditor("selectAll")};this.save=function(){U.commitChanges()};this.cancel=function(){S.nfeditor("setValue",W);U.cancelChanges()};this.hide=function(){P.hide()};this.show=function(){P.show();S.nfeditor("refresh")};this.position=function(Y){P.css({top:Y.top-16,left:Y.left-42})};this.destroy=function(){S.nfeditor("destroy");P.remove();V.remove()};this.focus=function(){S.nfeditor("focus")};this.loadValue=function(aa){var ab=false;var Y=F.isSensitiveProperty(T);if(F.isDefinedAndNotNull(aa[U.column.field])){if(Y){W=F.config.sensitiveText}else{W=aa[U.column.field];ab=W===""}}var Z;if(ab){Z="checkbox-checked";S.nfeditor("setReadOnly","nocursor")}else{Z="checkbox-unchecked"}R.addClass(Z);S.nfeditor("setValue",W).nfeditor("selectAll")};this.serializeValue=function(){var Y=S.nfeditor("getValue");if(Y===""){if(R.hasClass("checkbox-checked")){return""}if(F.isRequiredProperty(T)){if(F.isBlank(T.defaultValue)){return Q}return T.defaultValue}return null}if(S.nfeditor("isModified")===false){return Q}return Y};this.applyValue=function(Y,Z){Y[U.column.field]=Z};this.isValueChanged=function(){return X.serializeValue()!==Q};this.validate=function(){return{valid:true,msg:null}};this.init()}};var v=function(O,P){return function(Z){var ac={text:"Reference parameter...",value:undefined,optionClass:"unset"};var U={text:"Loading parameters...",value:null,optionClass:"unset",disabled:true};var T={text:"Create new service...",value:"createControllerService",optionClass:"unset"};var ab=this;var S=[];var ad=[];var aa=null;var R;var W;var Y;var X;var Q=true;var V;this.init=function(){var af=w("body");var ai=w(Z.grid.getContainerNode());var an=ai.data("descriptors");X=an[Z.item.property];var ap=ai.closest(".property-container");var ak=ap.data("options");R=w('<div class="combo-editor"></div>').css({"z-index":1999,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)"}).draggable({cancel:".button, .combo",containment:"parent"}).appendTo(af);var ah=F.getAllowableValues(X);if(w.isArray(ah)){w.each(ah,function(ar,at){var aq=at.allowableValue;S.push({text:aq.displayName,value:aq.value,disabled:at.canRead===false&&aq.value!==Z.item.previousValue,description:F.escapeHtml(aq.description)})})}if(X.required===false){S.push({text:"No value",value:null,optionClass:"unset"})}if(O){S.push(ac)}if(S.length===0){S.push({text:"No value",value:null,optionClass:"unset",disabled:true})}if(F.isDefinedAndNotNull(X.identifiesControllerService)){S.push(T)}var aj=Z.position;var ae=w(window).height();var am=ae-aj.bottom-16;var ag=Math.max(aj.width-16,g);W=w('<div class="value-combo combo"></div>').combo({options:S,maxHeight:am,select:function(aq){var ar=function(){ab.cancel();A(ai,Z.grid,Z.item,X.identifiesControllerService,X.identifiesControllerServiceBundle,ak)};if(O){if(F.isDefinedAndNotNull(Y)){if(aq===ac){Y.show()}else{Y.hide();if(aq===T){ar()}}}}else{if(aq===T){ar()}}}}).css({"margin-top":"10px","margin-bottom":"10px",width:ag+"px"}).appendTo(R);if(O){Y=w('<div class="value-combo combo"></div>').combo({options:[U],maxHeight:am}).css({"margin-bottom":"10px",width:ag+"px"}).appendTo(R);V=new w.Deferred(function(aq){P(X,function(ar){var at=M.sortBy(ar,"name");at.forEach(function(au){ad.push({text:au.name,value:"#{"+au.name+"}",description:F.escapeHtml(au.description)})});Y.combo("destroy").combo({options:ad,maxHeight:am});aq.resolve();Q=false})}).promise()}var ao=w('<div class="secondary-button">Cancel</div>').css({color:"#004849",background:"#E3E8EB"}).hover(function(){w(this).css("background","#C7D2D7")},function(){w(this).css("background","#E3E8EB")}).on("click",ab.cancel);var al=w('<div class="button">Ok</div>').css({color:"#fff",background:"#728E9B"}).hover(function(){w(this).css("background","#004849")},function(){w(this).css("background","#728E9B")}).on("click",ab.save);w("<div></div>").css({position:"relative",top:"10px",left:"20px",width:"212px","float":"right"}).append(al).append(ao).appendTo(R);ab.position(aj)};this.save=function(){Z.commitChanges()};this.cancel=function(){Z.cancelChanges()};this.hide=function(){R.hide()};this.show=function(){R.show()};this.position=function(ae){R.css({top:ae.top-24,left:ae.left-20})};this.destroy=function(){if(O){Y.combo("destroy")}W.combo("destroy");R.remove();S.length=0;ad.length=0};this.focus=function(){};this.loadValue=function(af){var ag;if(!F.isUndefined(af.value)){ag=af.value}else{if(F.isDefinedAndNotNull(X.defaultValue)){ag=X.defaultValue}}if(!F.isUndefined(ag)){aa=ag;var ae=S.find(function(ai){return aa===ai.value});if(!F.isUndefined(ae)){W.combo("setSelectedOption",ae)}else{if(O&&l(aa)){W.combo("setSelectedOption",ac);var ah={value:aa};if(Q){V.then(function(){Y.combo("setSelectedOption",ah)})}else{Y.combo("setSelectedOption",ah)}}else{W.combo("setSelectedOption",S[0])}}}else{W.combo("setSelectedOption",S[0])}};this.serializeValue=function(){var af=W.combo("getSelectedOption");var ae=af.value;if(O&&M.isUndefined(ae)){af=Y.combo("getSelectedOption");if(af===U){ae=aa}else{ae=af.value}}return ae};this.applyValue=function(ae,af){ae[Z.column.field]=af};this.isValueChanged=function(){var ae=ab.serializeValue();return ae!==aa};this.validate=function(){return{valid:true,msg:null}};this.init()}};var D=function(ac,af,V,O){b.removeAllPropertyDetailDialogs();var ab=ac.getData();var W=ab.getItem(V);if(F.isDefinedAndNotNull(W.value)){var X=af[W.property];if(!F.isSensitiveProperty(X)){var S=w(ac.getCellNode(V,O));var T=S.offset();var U=w('<div class="property-detail"></div>').css({"z-index":1999,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)",top:T.top-24,left:T.left-20}).appendTo("body");var P=F.getAllowableValues(X);if(w.isArray(P)){U.draggable({cancel:".button, .combo",containment:"parent"});var Q=[];w.each(P,function(ah,ai){var ag=ai.allowableValue;Q.push({text:ag.displayName,value:ag.value,description:F.escapeHtml(ag.description),disabled:true})});if(Q.length===0){Q.push({text:"No value",value:null,optionClass:"unset",disabled:true})}var Y=w(window).height();var ad=Y-(T.top+S.height())-16;var ae=S.width()-16;w('<div class="value-combo combo"></div>').css({width:ae,"margin-top":"10px","margin-bottom":"10px"}).combo({options:Q,maxHeight:ad,selectedOption:{value:W.value}}).appendTo(U);w('<div class="button">Ok</div>').css({position:"relative",top:"10px",left:"20px"}).hover(function(){w(this).css("background","#004849")},function(){w(this).css("background","#728E9B")}).on("click",function(){U.hide().remove()}).appendTo(U)}else{var R=null;if(F.supportsEl(X)){U.css({"z-index":1999,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)",top:T.top-22,left:T.left-43}).draggable({cancel:"input, textarea, pre, .button, .nf-editor",containment:"parent"});R=w("<div></div>").addClass("nf-editor").appendTo(U).nfeditor({languageMode:nf.nfel,width:S.width(),content:W.value,minWidth:175,minHeight:100,readOnly:true,resizable:true,escape:function(){aa()}})}else{U.css({"z-index":1999,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)",top:T.top-26,left:T.left-20});w('<textarea hidefocus rows="5" readonly="readonly" />').css({height:"80px",resize:"both",width:S.width()+"px",margin:"10px 0px","white-space":"pre"}).text(W.value).on("keydown",function(ag){if(ag.which===w.ui.keyCode.ESCAPE){aa();ag.stopImmediatePropagation();ag.preventDefault()}}).appendTo(U);U.draggable({containment:"parent"})}var aa=function(){if(R!==null){R.nfeditor("destroy")}U.hide().remove()};var Z=w('<div class="button">Ok</div>').css({position:"relative",top:"10px",left:"20px"}).hover(function(){w(this).css("background","#004849")},function(){w(this).css("background","#728E9B")}).on("click",function(){aa()});w("<div></div>").append(Z).append('<div class="clear"></div>').appendTo(U)}}}};var A=function(O,Q,R,S,P,T){w.ajax({type:"GET",url:"../nifi-api/flow/controller-service-types",data:{serviceType:S,serviceBundleGroup:P.group,serviceBundleArtifact:P.artifact,serviceBundleVersion:P.version},dataType:"json"}).done(function(V){var al=O.data("descriptors");var ac=al[R.property];var aj=d3.map();var aa=[];w.each(V.controllerServiceTypes,function(am,an){aj.set(am,an);aa.push({text:F.formatType(an),value:am,description:F.escapeHtml(an.description)})});if(aa.length===0){h.showOkDialog({headerText:"Controller Service",dialogContent:"No controller service types found that are applicable for this property."})}else{var ah='<div id="new-inline-controller-service-dialog" class="hidden dialog medium-dialog cancellable"><div class="dialog-content"><div><div class="setting-name">Requires Controller Service</div><div class="setting-field"><div class="new-inline-controller-service-requirement"></div></div></div><div><div class="setting-name">Compatible Controller Services</div><div class="setting-field"><div class="new-inline-controller-service-combo"></div></div></div><div><div class="setting-name">Controller Service Name</div><div class="setting-field"><input type="text" class="new-inline-controller-service-name"/></div></div><div><div class="setting-name">Bundle</div><div class="setting-field"><div class="new-inline-controller-service-bundle"></div></div></div><div><div class="setting-name">Tags</div><div class="setting-field"><div class="new-inline-controller-service-tags"></div></div></div><div><div class="setting-name">Description</div><div class="setting-field"><div class="new-inline-controller-service-description"></div></div></div></div></div>';var ag=w(ah).appendTo(T.dialogContainer);var W=ag.find("div.new-inline-controller-service-requirement");var ad=ag.find("div.new-inline-controller-service-combo");var ak=ag.find("input.new-inline-controller-service-name");var ab=ag.find("div.new-inline-controller-service-bundle");var Y=ag.find("div.new-inline-controller-service-tags");var ai=ag.find("div.new-inline-controller-service-description");var X=F.formatType({type:ac.identifiesControllerService,bundle:ac.identifiesControllerServiceBundle});var af=F.formatBundle(ac.identifiesControllerServiceBundle);W.text(X+" from "+af);aa.sort(function(an,am){var ao=aj.get(an.value);var ar=aj.get(am.value);var aq=F.substringAfterLast(ao.type,".");var ap=F.substringAfterLast(ar.type,".");return aq===ap?-F.sortVersion(ao.bundle.version,ar.bundle.version):aq>ap?1:-1});var U=F.formatClassName(aj.get(0));ak.val(U);ad.combo({options:aa,select:function(an){var am=aj.get(an.value);ab.text(F.formatBundle(am.bundle));Y.text(am.tags.join(", "));ai.text(am.description);if(U===ak.val().trim()){U=F.formatClassName(am);ak.val(U)}}});ag.modal({headerText:"Add Controller Service",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Create",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){ae()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){Z()}}}]});var ae=function(){var ao=ad.combo("getSelectedOption").value;var ap=aj.get(ao);var an=ak.val();var am={revision:e.getRevision({revision:{version:0,}}),disconnectedNodeAcknowledged:p.isDisconnectionAcknowledged(),component:{type:ap.type,bundle:ap.bundle}};if(an.trim()!==""){am.component.name=an.trim()}var aq="../nifi-api/controller/controller-services";if(F.isDefinedAndNotNull(H)){aq="../nifi-api/process-groups/"+encodeURIComponent(H)+"/controller-services"}w.ajax({type:"POST",url:aq,data:JSON.stringify(am),dataType:"json",contentType:"application/json"}).done(function(ar){T.descriptorDeferred(R.property,false).done(function(aw){var av=aw.propertyDescriptor;var at=O.data("descriptors");if(!F.isUndefined(at)){at[av.name]=av}var au=Q.getData();au.updateItem(R.id,w.extend(R,{value:ar.component.id}));ag.modal("hide")});if(typeof T.controllerServiceCreatedDeferred==="function"){T.controllerServiceCreatedDeferred(ar)}}).fail(c.handleAjaxError)};var Z=function(){ag.modal("hide")};ag.modal("show")}}).fail(c.handleAjaxError)};var o=function(X,Y){var O=function(){var Z=X.closest(".dialog");if(Z.hasClass("modal")){Z.modal("hide")}else{Z.hide()}};var U=function(ai,ag,af,ac,aa){var ae=30;var Z=w("<div></div>");var ab=w("<span/>").addClass("table-cell").text(af).appendTo(Z);if(aa.type==="required"){ab.addClass("required")}var ah=X.data("descriptors");var ad=ah[aa.property];if(F.isDefinedAndNotNull(ad)){if(!F.isBlank(ad.description)||!F.isBlank(ad.defaultValue)||!F.isBlank(ad.supportsEl)){w('<div class="fa fa-question-circle" alt="Info" style="float: right;"></div>').appendTo(Z);w('<span class="hidden property-descriptor-name"></span>').text(aa.property).appendTo(Z);ae=46}}ab.width(ac.width-ae).ellipsis();return Z.html()};var V=function(al,aj,ai,ac,Z){var ag;var af=0;if(F.isDefinedAndNotNull(ai)){var ak=X.data("descriptors");var ae=ak[Z.property];if(F.isSensitiveProperty(ae)){ag='<span class="table-cell sensitive">Sensitive value set</span>'}else{var ab=false;var aa=F.getAllowableValues(ae);if(w.isArray(aa)){w.each(aa,function(am,ao){var an=ao.allowableValue;if(ai===an.value){ai=an.displayName;ab=true;return false}})}if(ai===""){ag='<span class="table-cell blank">Empty string set</span>'}else{af=10;if(F.isMultiLine(ai)){ag='<div class="table-cell value"><div class="ellipsis-white-space-pre multi-line-clamp-ellipsis">'+F.escapeHtml(ai)+"</div></div>"}else{ag='<div class="table-cell value"><div class="ellipsis-white-space-pre">'+F.escapeHtml(ai)+"</div></div>"}if(F.hasLeadTrailWhitespace(ai)){ag+='<div class="fa fa-info" alt="Info" style="float: right;"></div>';af=20}}}}else{ag='<span class="unset">No value set</span>'}var ad=w(ag);if(Z.type==="required"){ad.addClass("required")}var ah=ad.find(".ellipsis-white-space-pre");ah.attr("title",ah.text()).width(ac.width-10-af);return w("<div />").append(ad).html()};var P=[{id:"property",field:"displayName",name:"Property",sortable:false,resizable:true,rerenderOnResize:true,formatter:U},{id:"value",field:"value",name:"Value",sortable:false,resizable:true,cssClass:"pointer",rerenderOnResize:true,formatter:V}];var T=function(an,aj,ai,ad,ab){var am="";var al=X.data("descriptors");var af=al[ab.property];var aa=F.isDefinedAndNotNull(af.identifiesControllerService);var Z=F.isDefinedAndNotNull(ab.value);if(aa&&Z&&(Y.supportsGoTo===true)){w.each(af.allowableValues,function(ao,aq){var ap=aq.allowableValue;if(ap.value===ab.value){am+='<div class="pointer go-to-service fa fa-long-arrow-right" title="Go To"></div>';return false}})}var ae=u(ab.value);var ak=false;var ac=false;if(M.isFunction(Y.getParameterContext)){var ah=Y.getParameterContext(H);var ag=M.get(ah,"permissions.canWrite",false);ac=M.get(ah,"permissions.canRead",false);ak=ag&&ac}if(ae&&ac){am+='<div title="Go to parameter" class="go-to-parameter pointer fa fa-long-arrow-right"></div>'}if(Y.readOnly!==true){if(ak&&!ae){am+='<div title="Convert to parameter" class="convert-to-parameter pointer fa fa-level-up"></div>'}if(ab.type==="userDefined"){am+='<div title="Delete" class="delete-property pointer fa fa-trash"></div>'}}return am};P.push({id:"actions",name:"&nbsp;",minWidth:20,width:20,formatter:T});var Q={autosizeColsMode:a.GridAutosizeColsMode.LegacyForceFit,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,editable:Y.readOnly!==true,enableAddRow:false,autoEdit:false,rowHeight:24};var W=new a.Data.DataView({inlineFilters:false});W.setItems([]);W.setFilterArgs({searchString:"",property:"hidden"});W.setFilter(y);W.getItemMetadata=function(aa){var ad=W.getItem(aa);var ac=X.data("descriptors");var Z=ac[ad.property];var af=function(ah,ag,ai){ag(ah,H).done(function(aj){ai(aj)})};var ab=typeof Y.parameterDeferred==="function";if(F.isUndefinedOrNull(Z)||F.supportsEl(Z)){return{columns:{value:{editor:f(function(ag){if(ab){nf.nfel.enableParameters();af(ag,Y.parameterDeferred,nf.nfel.setParameters)}else{nf.nfel.disableParameters()}return nf.nfel})}}}}else{var ae=F.getAllowableValues(Z);if(w.isArray(ae)){return{columns:{value:{editor:v(ab,function(ag,ah){if(ab){af(ag,Y.parameterDeferred,ah)}})}}}}else{return{columns:{value:{editor:f(function(ag){if(ab){nf.nfpr.enableParameters();af(ag,Y.parameterDeferred,nf.nfpr.setParameters)}else{nf.nfpr.disableParameters()}return nf.nfpr})}}}}}};var S=function(Z){w.ajax({type:"GET",url:"../nifi-api/controller-services/"+encodeURIComponent(Z.value),dataType:"json",data:{uiOnly:true}}).done(function(aa){O();var ab=aa.component;w.Deferred(function(ac){if(F.isDefinedAndNotNull(ab.parentGroupId)){t.enterGroup(ab.parentGroupId).done(function(){if(w("#process-group-configuration").is(":visible")){z.loadConfiguration(ab.parentGroupId).done(function(){ac.resolve()})}else{z.showConfiguration(ab.parentGroupId).done(function(){ac.resolve()})}})}else{if(w("#settings").is(":visible")){C.loadSettings().done(function(){ac.resolve()})}else{C.showSettings().done(function(){ac.resolve()})}}}).done(function(){if(F.isDefinedAndNotNull(ab.parentGroupId)){z.selectControllerService(Z.value)}else{C.selectControllerService(Z.value)}})}).fail(c.handleAjaxError)};var R=new a.Grid(X,W,P,Q);R.setSelectionModel(new a.RowSelectionModel());R.onClick.subscribe(function(ad,af){if(R.getColumns()[af.cell].id==="value"){if(Y.readOnly===true){var aj=X.data("descriptors");D(R,aj,af.row,af.cell)}else{R.gotoCell(af.row,af.cell,true)}ad.stopImmediatePropagation()}else{if(R.getColumns()[af.cell].id==="actions"){var ai=W.getItem(af.row);var ae=w(ad.target);if(ae.hasClass("delete-property")){W.updateItem(ai.id,w.extend(ai,{hidden:true}));var aj=X.data("descriptors");delete aj[ai.property];ad.stopImmediatePropagation()}else{if(ae.hasClass("go-to-service")){if(Y.readOnly===true){S(ai)}else{if(typeof Y.goToServiceDeferred==="function"){Y.goToServiceDeferred().done(function(){S(ai)})}}}else{if(ae.hasClass("convert-to-parameter")){var Z;var ak=false;if(M.isFunction(Y.getParameterContext)){Z=Y.getParameterContext(H);var ag=M.get(Z,"permissions.canWrite",false);var aa=M.get(Z,"permissions.canRead",false);ak=ag&&aa}if(Y.readOnly!==true&&ak){var aj=X.data("descriptors");var ac=aj[ai.property];J.convertPropertyToParameter(ai,ac,Z.id).done(function(an){var am=M.extend({},ai,{previousValue:ai.value,value:"#{"+an.name+"}"});W.updateItem(ai.id,am)})}}else{if(ae.hasClass("go-to-parameter")){var Z;if(M.isFunction(Y.getParameterContext)){Z=Y.getParameterContext(H);var aa=M.get(Z,"permissions.canRead",false);if(aa&&!M.isNil(ai.value)){var ab=/#{([a-zA-Z0-9-_. ]+)}/;var al=ai.value.match(ab);if(!M.isEmpty(al)&&al.length===2){O();var ah=al[1];J.showParameterContext(Z.id,null,ah)}}}}}}}}}});R.onKeyDown.subscribe(function(aa,Z){if(aa.which===w.ui.keyCode.ESCAPE){var ab=R.getEditorLock();if(ab.isActive()){ab.cancelCurrentEdit();aa.stopImmediatePropagation();aa.preventDefault()}}});if(Y.readOnly!==true){R.onBeforeEditCell.subscribe(function(aa,Z){F.cleanUpTooltips(X,"div.fa-question-circle, div.fa-info")});R.onBeforeCellEditorDestroy.subscribe(function(aa,Z){setTimeout(function(){var ad=R.getData();var ac=X.data("descriptors");var ab=ad.getItems();w.each(ab,function(ai,af){var ah=ac[af.property];var ae=false;if(!ah.dynamic){var ag=false;if(ah.dependencies.length>0){w.each(ah.dependencies,function(ak,aj){if(ag){return false}w.each(ab,function(am,an){if(an.property===aj.propertyName){ae=true;if(an.hidden===false){var al=an.value;if(al!=null){if(aj.hasOwnProperty("dependentValues")){ag=!aj.dependentValues.includes(al)}}else{ag=true}}else{ag=true}if(ag){return false}}})})}}else{ag=af.hidden}ad.beginUpdate();ad.updateItem(ai,w.extend(af,{hidden:ag,dependent:ae}));ad.endUpdate();ag=false});R.resizeCanvas()},50)})}W.onRowCountChanged.subscribe(function(aa,Z){R.updateRowCount();R.render()});W.onRowsChanged.subscribe(function(aa,Z){R.invalidateRows(Z.rows);R.render()});X.data("gridInstance",R).on("mouseenter","div.slick-cell",function(ab){var af=w(this).find("div.fa-question-circle");if(af.length&&!af.data("qtip")){var ag=w(this).find("span.property-descriptor-name").text();var ai=X.data("descriptors");var ad=ai[ag];var ac=X.data("history");var ae;if(ac){ae=ac[ag]}var Z=F.formatPropertyTooltip(ad,ae);if(F.isDefinedAndNotNull(Z)){af.qtip(w.extend({},F.config.tooltipConfig,{content:Z}))}}var ah=w(this).find("div.fa-info");if(ah.length&&!ah.data("qtip")){var aa=F.formatWhitespaceTooltip();ah.qtip(w.extend({},F.config.tooltipConfig,{content:aa}))}})};var r=function(Q){var P=Q.data("gridInstance");if(F.isDefinedAndNotNull(P)){var O=P.getEditController();O.commitCurrentEdit()}};var m=function(R){var P={};var O=R.data("gridInstance");var Q=O.getData();w.each(Q.getItems(),function(){if(this.hidden===true&&!(this.dependent===true)){P[this.property]=null}else{if(this.value!==this.previousValue){P[this.property]=this.value}}});return P};var n=function(Q){var O=[];var P=Q.data("descriptors");w.each(P,function(){if(F.isSensitiveProperty(this)===true&&F.isDynamicProperty(this)===true){O.push(this.name)}});return O};var y=function(P,O){return P.hidden===false};var G=function(T,Q,R,U){T.data({descriptors:R,history:U});var O=T.data("gridInstance");var S=O.getData();if(F.isDefinedAndNotNull(Q)){S.beginUpdate();var P=0;w.each(Q,function(W,aa){var ab=R[W];var Y="userDefined";var V=W;if(F.isDefinedAndNotNull(ab)){if(F.isRequiredProperty(ab)){Y="required"}else{if(F.isDynamicProperty(ab)){Y="userDefined"}else{Y="optional"}}V=ab.displayName;if(F.isNull(aa)&&F.isDefinedAndNotNull(ab.defaultValue)){aa=ab.defaultValue}}var Z=false;var X=false;if(ab.dependencies.length>0){w.each(ab.dependencies,function(ae,ad){if(Z){return false}var ac=S.getItems();w.each(ac,function(ag,ah){if(ah.property===ad.propertyName){X=true;if(ah.hidden===false){var af=Q[ad.propertyName];if(af!=null){if(ad.hasOwnProperty("dependentValues")){Z=!ad.dependentValues.includes(af)}}else{Z=true}}else{Z=true}if(Z){return false}}})})}S.addItem({id:P++,hidden:Z,dependent:X,property:W,displayName:V,previousValue:aa,value:aa,type:Y});Z=false});S.endUpdate()}};var B=function(S){var P=S.data("options");if(P.readOnly===true){b.removeAllPropertyDetailDialogs()}else{if(F.isDefinedAndNotNull(P.dialogContainer)){w("#new-property-dialog").modal("hide")}}var R=S.find("div.property-table");R.removeData("descriptors history");F.cleanUpTooltips(R,"div.fa-question-circle, div.fa-info");var O=R.data("gridInstance");var Q=O.getData();Q.setItems([])};var x={init:function(O){return this.each(function(){if(F.isDefinedAndNotNull(O)){var V=w(this);V.empty().unbind().addClass("property-container").data("options",O);var U=w('<div class="properties-header"></div>').appendTo(V);w('<div class="required-property-note">Required field</div>').appendTo(U);var ab=w('<div class="property-table"></div>').appendTo(V);if(O.readOnly!==true&&F.isDefinedAndNotNull(O.dialogContainer)){var S='<div id="new-property-dialog" class="dialog cancellable small-dialog hidden"><div class="dialog-content"><div class="setting"><div class="setting-name">Property name</div><div class="setting-field new-property-name-container"><input class="new-property-name" type="text"/></div></div><div class="setting"><div class="setting-name">Sensitive Value <span class="fa fa-question-circle" alt="Info" title="Components must declare support for Sensitive Dynamic Properties to enable selection of Sensitive Value status. Components that flag dynamic properties as sensitive do not allow Sensitive Value status to be changed."></span></div><div class="setting-field"><input id="value-sensitive-radio-button" type="radio" name="sensitive" value="sensitive" /> Yes<input id="value-not-sensitive-radio-button" type="radio" name="sensitive" value="plain" style="margin-left: 20px;"/> No</div></div></div></div>';var Q=w(S).appendTo(O.dialogContainer);var T=Q.find("input.new-property-name");var R=Q.find("#value-sensitive-radio-button");var W=Q.find("#value-not-sensitive-radio-button");Q.modal({headerText:"Add Property",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){aa()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){Z()}}}]});var aa=function(){var ad=w.trim(T.val());if(ad!==""){var ae=ab.data("gridInstance");var ag=ae.getData();var af=null;w.each(ag.getItems(),function(ai,aj){if(ad===aj.property){af=aj;return false}});if(af===null||af.hidden===true){var ac=R.prop("checked");O.descriptorDeferred(ad,ac).done(function(ai){var ak=ai.propertyDescriptor;var aj=ab.data("descriptors");if(!F.isUndefined(aj)){aj[ak.name]=ak}if(af===null){var am=ag.getItems().length;ag.addItem({id:am,hidden:false,property:ad,displayName:ad,previousValue:null,value:null,type:"userDefined"});var al=ag.getRowById(am);ae.setActiveCell(al,ae.getColumnIndex("value"));ae.editActiveCell()}else{ag.updateItem(af.id,w.extend(af,{hidden:false,previousValue:null,value:null}));var al=ag.getRowById(af.id);ae.invalidateRow(al);ae.render();ae.setActiveCell(al,ae.getColumnIndex("value"));ae.editActiveCell()}})}else{h.showOkDialog({headerText:"Property Exists",dialogContent:"A property with this name already exists."});var ah=ag.getRowById(af.id);ae.setSelectedRows([ah]);ae.scrollRowIntoView(ah)}}else{h.showOkDialog({headerText:"Property Name",dialogContent:"Property name must be specified."})}Q.modal("hide")};var Z=function(){Q.modal("hide")};T.on("keydown",function(ad){var ac=ad.keyCode?ad.keyCode:ad.which;if(ac===w.ui.keyCode.ENTER){aa();ad.stopImmediatePropagation();ad.preventDefault()}});Q.on("click","div.new-property-ok",aa).on("click","div.new-property-cancel",Z);var X=w('<div class="add-property" title="Add Property"></div>').appendTo(U);w('<button class="button fa fa-plus"></button>').on("click",function(){r(ab);T.val("");Q.modal("show");T.focus();R.prop("checked",false);W.prop("checked",true);var ac=K!==true;R.prop("disabled",ac);W.prop("disabled",ac)}).appendTo(X);var P=w('<div class="verify-properties hidden" title="Verify Properties"></div>').appendTo(U);w('<button class="button fa fa-check-circle-o"></button>').on("click",function(){r(ab);s(m(ab))}).appendTo(P);s=O.propertyVerificationCallback;var Y=typeof s==="function";P.toggleClass("hidden",!Y)}w('<div class="clear"></div>').appendTo(U);o(ab,O)}})},loadProperties:function(O,P,Q){return this.each(function(){var R=w(this).find("div.property-table");G(R,O,P,Q)})},saveRow:function(){return this.each(function(){var O=w(this).find("div.property-table");r(O)})},resetTableSize:function(){return this.each(function(){var P=w(this).find("div.property-table");var O=P.data("gridInstance");if(F.isDefinedAndNotNull(O)){O.resizeCanvas()}})},cancelEdit:function(){return this.each(function(){var Q=w(this).find("div.property-table");var P=Q.data("gridInstance");if(F.isDefinedAndNotNull(P)){var O=P.getEditController();O.cancelCurrentEdit()}})},destroy:function(){return this.each(function(){var P=w(this);var O=P.data("options");if(F.isDefinedAndNotNull(O)){B(P);if(F.isDefinedAndNotNull(O.dialogContainer)){w("#new-property-dialog").modal("hide");w(O.dialogContainer).children("div.new-inline-controller-service-dialog").remove()}}})},clear:function(){return this.each(function(){B(w(this))})},isSaveRequired:function(){var O=false;this.each(function(){var R=w(this).find("div.property-table");var P=R.data("gridInstance");var Q=P.getData();w.each(Q.getItems(),function(){if(this.value!==this.previousValue){O=true;return false}});return false});return O},marshalProperties:function(){var O={};this.each(function(){var P=w(this).find("div.property-table");O=m(P);return false});return O},getSensitiveDynamicPropertyNames:function(){var O=[];this.each(function(){var P=w(this).find("div.property-table");O=n(P);return false});return O},setGroupId:function(O){return this.each(function(){H=O})},setSupportsSensitiveDynamicProperties:function(O){return this.each(function(){K=O})},setPropertyVerificationCallback:function(O){return this.each(function(){s=O;var P=typeof O==="function";w(this).find("div.verify-properties").toggleClass("hidden",!P)})}};w.fn.propertytable=function(O){if(x[O]){return x[O].apply(this,Array.prototype.slice.call(arguments,1))}else{return x.init.apply(this,arguments)}}}));